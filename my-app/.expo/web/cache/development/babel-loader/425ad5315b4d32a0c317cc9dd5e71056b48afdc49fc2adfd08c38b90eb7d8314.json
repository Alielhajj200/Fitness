{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\HP\\\\Desktop\\\\work\\\\loginregisterts\\\\my-app\\\\app\\\\context\\\\AuthContext.tsx\",\n  _this = this;\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport axios from 'axios';\nimport * as SecureStore from 'expo-secure-store';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar API_URL_login = 'https://dummyjson.com/auth/login';\nvar API_URL_Register = '';\nvar TOKEN_KEY = 'abcd123';\nvar ROLE_KEY = \"abcd12\";\nvar AuthContext = createContext({});\nexport var useAuth = function useAuth() {\n  return useContext(AuthContext);\n};\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children,\n    navigation = _ref.navigation;\n  var _useState = useState({\n      token: null,\n      authenticated: null,\n      role: null\n    }),\n    _useState2 = _slicedToArray(_useState, 2),\n    authState = _useState2[0],\n    setAuthState = _useState2[1];\n  function parsejwt(token) {\n    var base64url = token.split('.')[1];\n    var base64 = decodeURIComponent(atob(base64url).split('').map(function (c) {\n      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n    }).join(''));\n    return JSON.parse(base64);\n  }\n  useEffect(function () {\n    var loadTokenAndRole = function () {\n      var _ref2 = _asyncToGenerator(function* () {\n        var token = yield SecureStore.getItemAsync(TOKEN_KEY);\n        var role = yield SecureStore.getItemAsync(ROLE_KEY);\n        if (token && role) {\n          axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n          setAuthState({\n            token: token,\n            authenticated: true,\n            role: role\n          });\n        }\n      });\n      return function loadTokenAndRole() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    loadTokenAndRole();\n  }, []);\n  var register = function () {\n    var _ref3 = _asyncToGenerator(function* (firstname, lastname, email, password) {\n      try {\n        console.log(\"register func\");\n        var response = yield fetch(API_URL_Register, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            firstname: firstname,\n            lastname: lastname,\n            email: email,\n            password: password\n          })\n        });\n        if (!response.ok) {\n          var errorMessage = yield response.json();\n          return {\n            error: true,\n            msg: errorMessage.msg\n          };\n        } else if (response.ok) {\n          console.log(response.json);\n        }\n        return yield response.json();\n      } catch (e) {\n        return {\n          error: true,\n          msg: 'An error occurred while registering.'\n        };\n      }\n    });\n    return function register(_x, _x2, _x3, _x4) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var login = function () {\n    var _ref4 = _asyncToGenerator(function* (username, password) {\n      try {\n        var response = yield fetch(API_URL_login, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            username: username,\n            password: password,\n            \"expiresInMins\": 1\n          })\n        });\n        if (!response.ok) {\n          throw new Error('Network response was not ok');\n        }\n        var result = yield response.json();\n        var role = result.role;\n        setAuthState({\n          token: result.token,\n          authenticated: true,\n          role: role\n        });\n        axios.defaults.headers.common['Authorization'] = `Bearer ${result.token}`;\n        yield SecureStore.setItemAsync(TOKEN_KEY, result.token);\n        yield SecureStore.setItemAsync(ROLE_KEY, result.role);\n        var decodedData = parsejwt(result.token);\n        console.log(decodedData);\n        return result;\n      } catch (error) {\n        return {\n          error: true,\n          msg: error.message\n        };\n      }\n    });\n    return function login(_x5, _x6) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  var logout = function () {\n    var _ref5 = _asyncToGenerator(function* () {\n      yield SecureStore.deleteItemAsync(TOKEN_KEY);\n      axios.defaults.headers.common['Authorization'] = '';\n      setAuthState({\n        token: null,\n        authenticated: false,\n        role: null\n      });\n      navigation.navigate(\"Welcome\");\n    });\n    return function logout() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  var value = {\n    onRegister: register,\n    onLogin: login,\n    onLogout: logout,\n    authState: authState\n  };\n  return _jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 168,\n    columnNumber: 12\n  }, _this);\n};","map":{"version":3,"names":["createContext","useContext","useEffect","useState","axios","SecureStore","jsxDEV","_jsxDEV","API_URL_login","API_URL_Register","TOKEN_KEY","ROLE_KEY","AuthContext","useAuth","AuthProvider","_ref","children","navigation","_useState","token","authenticated","role","_useState2","_slicedToArray","authState","setAuthState","parsejwt","base64url","split","base64","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","loadTokenAndRole","_ref2","_asyncToGenerator","getItemAsync","defaults","headers","common","apply","arguments","register","_ref3","firstname","lastname","email","password","console","log","response","fetch","method","body","stringify","ok","errorMessage","json","error","msg","e","_x","_x2","_x3","_x4","login","_ref4","username","Error","result","setItemAsync","decodedData","message","_x5","_x6","logout","_ref5","deleteItemAsync","navigate","value","onRegister","onLogin","onLogout","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_this"],"sources":["C:/Users/HP/Desktop/work/loginregisterts/my-app/app/context/AuthContext.tsx"],"sourcesContent":["\r\nimport { createContext, useContext, useEffect, useState } from \"react\";\r\nimport axios from 'axios';\r\nimport * as SecureStore from 'expo-secure-store';\r\nimport { useNavigation } from \"@react-navigation/native\";\r\nimport jwt from 'jsonwebtoken';\r\nimport * as Crypto from 'expo-crypto';\r\nimport jwtDecode from 'jwt-decode';\r\n\r\n\r\n\r\ninterface AuthProps {\r\n    authState?: { token: string | null; authenticated: boolean | null ;role:string|null};\r\n    onRegister?: (firstname:string,lastname:string,email: string, password: string) => Promise<any>;\r\n    onLogin?: (username: string, password: string) => Promise<any>;\r\n    onLogout?: () => Promise<any>;\r\n}\r\n\r\nconst API_URL_login = 'https://dummyjson.com/auth/login';\r\nconst API_URL_Register = '';\r\nconst TOKEN_KEY = 'abcd123';\r\nconst ROLE_KEY=\"abcd12\"\r\nconst AuthContext = createContext<AuthProps>({});\r\n\r\nexport const useAuth = () => {\r\n    return useContext(AuthContext);\r\n};\r\n\r\nexport const AuthProvider = ({ children ,navigation}: any) => {\r\n    const [authState, setAuthState] = useState<{\r\n        token: string | null;\r\n        authenticated: boolean | null;\r\n        role:string | null;\r\n    }>({\r\n        token: null,\r\n        authenticated: null,\r\n        role:null\r\n    });\r\n    function parsejwt(token: string){\r\n        var base64url=token.split('.')[1];\r\n        var base64=decodeURIComponent(atob(base64url).split('').map((c)=>{\r\n            return '%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);\r\n        }).join(''));\r\n        return JSON.parse(base64);\r\n      }\r\n    \r\n    useEffect(() => {\r\n        const loadTokenAndRole = async () => {\r\n            const token = await SecureStore.getItemAsync(TOKEN_KEY);\r\n            const role = await SecureStore.getItemAsync(ROLE_KEY); // Assuming you have a ROLE_KEY constant for the role\r\n    \r\n            if (token && role) { // Check both token and role existence\r\n                axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n    \r\n                setAuthState({\r\n                    token: token,\r\n                    authenticated: true,\r\n                    role: role, // Set role in the auth state\r\n                });\r\n            }\r\n        };\r\n        loadTokenAndRole();\r\n    }, []);\r\n\r\n    const register = async (firstname: string, lastname: string, email: string, password: string) => {\r\n        try {\r\n            console.log(\"register func\")\r\n            const response = await fetch(API_URL_Register, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                },\r\n                body: JSON.stringify({ firstname, lastname, email, password }),\r\n                \r\n                \r\n            });\r\n            \r\n    \r\n            if (!response.ok) {\r\n                const errorMessage = await response.json();\r\n                return { error: true, msg: errorMessage.msg };\r\n            }\r\n            else if(response.ok){\r\n                \r\n                console.log(response.json)\r\n            }\r\n            return await response.json();\r\n\r\n        } catch (e) {\r\n            return { error: true, msg: 'An error occurred while registering.' };\r\n        }\r\n    };\r\n    \r\n\r\n    const login = async (username: string, password: string) => {\r\n\r\n        try {\r\n             const response = await fetch(API_URL_login, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json'\r\n                },\r\n                body: JSON.stringify({\r\n                     username:username,\r\n                     password:password,\r\n                     \"expiresInMins\": 1\r\n                     })\r\n            });\r\n            \r\n    \r\n            if (!response.ok) {\r\n                throw new Error('Network response was not ok');\r\n            }\r\n            \r\n            const result = await response.json();\r\n            const role=result.role;\r\n            \r\n            \r\n            \r\n            setAuthState({\r\n                token: result.token,\r\n                authenticated: true,\r\n                role:role\r\n            });\r\n    \r\n            // Set token in Axios defaults headers\r\n            axios.defaults.headers.common['Authorization'] = `Bearer ${result.token}`;\r\n    \r\n            // Store token securely\r\n            await SecureStore.setItemAsync(TOKEN_KEY, result.token);\r\n            await SecureStore.setItemAsync(ROLE_KEY,result.role)\r\n    \r\n\r\n\r\n            \r\n              \r\n\r\n            const decodedData = parsejwt(result.token);\r\n            console.log(decodedData)\r\n            return result; \r\n        } catch (error) {\r\n            return { error: true, msg: error.message };\r\n        }\r\n    };\r\n    \r\n\r\n    const logout = async () => {\r\n        await SecureStore.deleteItemAsync(TOKEN_KEY);\r\n\r\n        axios.defaults.headers.common['Authorization'] = '';\r\n        setAuthState({\r\n            token: null,\r\n            authenticated: false,\r\n            role:null\r\n        });\r\n        navigation.navigate(\"Welcome\"); // Assuming 'Welcome' is the name of your welcome screen\r\n\r\n        \r\n    };\r\n\r\n    const value = {\r\n        onRegister: register,\r\n        onLogin: login,\r\n        onLogout: logout,\r\n        authState,\r\n    };\r\n\r\n    return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n    \r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}